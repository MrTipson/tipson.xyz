---
import Layout from "@/layout/layout.astro";
import "@/styles/windows.css";
import "@/styles/markdown.css";
import { getCollection, type CollectionEntry } from "astro:content";
import DesktopShortcut, { ListWindow, SimpleWindow } from "@/components/DesktopShortcut.astro";
import Project2ListWindow from "@/components/Project2ListWindow.astro";
import { getEntry } from "astro:content";
import { GithubWindow, Icon } from "@/components";

const projects = await getCollection('projects');
const about = await getEntry("simple", "about")
					.then(entry => entry.render())
					.then(({ Content }) => Content);
---
<Layout title="Portal" description="portal">
	<template id="window-template">
		<div id="window" class="window draggable">
			<div class="window-resize" data-side="top"></div>
			<div class="window-resize" data-side="bottom"></div>
			<div class="window-resize" data-side="left"></div>
			<div class="window-resize" data-side="right"></div>
			<div class="window-resize" data-side="topright"></div>
			<div class="window-resize" data-side="topleft"></div>
			<div class="window-resize" data-side="bottomleft"></div>
			<div class="window-resize" data-side="bottomright"></div>
			<div class="window-bar">
				<div class="text-overflow-wrapper">
					<div id="title" class="text-overflow title">TODO</div>
				</div>
				<div id="buttons" class="buttons">
					<div id="minimise" class="minimise">-</div>
					<div id="close" class="close">x</div>
				</div>
			</div>
			<div id="content" class="window-content"></div>
		</div>
	</template>
	<template id="tab-template">
		<div id="docked" class="docked">
			TODO
		</div>
	</template>

	<div class="wrap">
		<div id="desktop" class="desktop">
			<div class="wallpaper">
				<svg class="absolute inset-0 w-1/2 h-1/2 m-auto text-c2-accent" viewBox="0 0 200 200">
					<path
						d="M 154 152 C 156 134 154 124 146 118 c -18 -12 -28 -2 -46 -14 C 62 82 70 40 104 34 C 148 28 166 72 164 88 M 98 48 C 100 54 108 48 114 48 C 118 46 124 58 134 64 C 141.3334 69.3334 172 80 156 80 M 114 56 C 116 60 112 60 118 66 C 130 82 152 78 156 80 C 168 86 168 102 164 106 M 110 64 C 120 98 166 70 164 114 M 104 66 C 108 70 106 74 106 76 C 116 100 174 92 162 126 M 98 72 C 98 76 98 90 118 98 C 178 112 162 138 154 152 M 96 36 C 76 36 68 42 62 50 L 68 38 C 46 44 34 78 32 100 M 40 114 C 36 110 34 106 32 100 C 32 178 104 174 130 160 M 40 114 C 40 86 69 88 82 104 C 102 133 62 150 48 132 C 47.3334 136.6666 46.6666 141.3334 44 144 M 78 116 C 74 124 64 126 58 122 M 40 126 C 40 128 38 130 36 128 M 40 114 C 30 84 58 40 56 54 M 40 84 C 42 86 44 86 48 82 C 48 80 48 74 54 76 c 8 6 -6 10 -6 6 C 50 76 50 86 48 82 M 50 76 C 56 68 60 80 56 82 M 54 74 C 60 70 60 66 58 62 M 38 74 C 38 76 34 88 40 84 C 42.6666 88 45.3334 92 48 96 C 56 88 66 76 80 86 M 96 102 C 100 108 102 118 102 120 C 108 120 116 122 120 126 C 114.6666 133.3334 109.3334 140.6666 106 146 C 98 142 87 137 75 137 M 51 144 C 55 143 58 142 62 140 C 58 144 56 145 53 146 C 48 145 48 139 48 132 M 61 92 C 87 89 104 123 75 137 M 154 141 C 146 161 168 160 157 179 C 160 167 134 157 154 132 M 147 119 C 146 140 122 151 133 171 C 135 142 147 150 152 125 M 146 153 C 146 158 146 164 147 170 C 140 164 141 152 141 147 M 136 157 C 137.6667 156 139 156 141 154"
						class="stroke-current fill-none stroke-[1]" stroke-linecap="round" stroke-linejoin="round"
						pathLength="100" stroke-dasharray="1 100">
						<animate attributeName="stroke-dasharray" values="1 100;100 100;" dur="5s" repeatCount="1"
							fill="freeze" />
					</path>
				</svg>
				<div class="sun">
					<div class="sun-center"></div>
				</div>
				<div class="stars"></div>
				<div class="trees"></div>
				<div class="mountains"></div>
			</div>
			<DesktopShortcut title="Projects" xpos="20px" ypos="50px" type="list">
				<Icon slot="icon" variant="folder"/>
				<ListWindow slot="content" mapping={{
					name: (entry: CollectionEntry<"projects">) => entry.data.title,
					content: Project2ListWindow,
				}} values={projects}/>
			</DesktopShortcut>
			<DesktopShortcut title="Recursion" xpos="20px" ypos="150px" type="simple">
				<Icon slot="icon" variant="spiral"/>
				<SimpleWindow slot="content" content_web={"/?recursion"}/>
			</DesktopShortcut>
			<DesktopShortcut title="About me" xpos="20px" ypos="250px" type="simple">
				<Icon slot="icon" variant="person"/>
				<SimpleWindow slot="content" content={about}/>
			</DesktopShortcut>
			<DesktopShortcut title="WebStg" xpos="120px" ypos="50px" type="explorer">
				<div slot="icon" class="text-c2-accent w-12 h-12 relative">
					<Icon variant="folder"/>
					<Icon variant="github" class="absolute inset-0 m-auto text-c0 w-6 h-6"/>
				</div>
				<GithubWindow slot="content" user="mrtipson" repository="webstg" tree_sha="master"/>
			</DesktopShortcut>
			<DesktopShortcut title="WebStg" xpos="220px" ypos="50px" type="simple">
				<div slot="icon" class="text-purple-500 w-12 h-12 relative">
					<Icon variant="folder"/>
					<Icon variant="mesh_globe" class="absolute inset-0 m-auto text-c0 w-6 h-6"/>
				</div>
				<SimpleWindow slot="content" content_web="https://mrtipson.github.io/webstg"/>
			</DesktopShortcut>
			<DesktopShortcut title="FogBuddy" xpos="120px" ypos="150px" type="explorer">
				<div slot="icon" class="text-c2-accent w-12 h-12 relative">
					<Icon variant="folder"/>
					<Icon variant="github" class="absolute inset-0 m-auto text-c0 w-6 h-6"/>
				</div>
				<GithubWindow slot="content" user="mrtipson" repository="fogbuddy" tree_sha="master"/>
			</DesktopShortcut>
			<DesktopShortcut title="Compiler" xpos="120px" ypos="250px" type="explorer">
				<div slot="icon" class="text-c2-accent w-12 h-12 relative">
					<Icon variant="folder"/>
					<Icon variant="github" class="absolute inset-0 m-auto text-c0 w-6 h-6"/>
				</div>
				<GithubWindow slot="content" user="mrtipson" repository="compiler" tree_sha="master"/>
			</DesktopShortcut>
			<DesktopShortcut title="Compiler" xpos="220px" ypos="250px" type="simple">
				<div slot="icon" class="text-purple-500 w-12 h-12 relative">
					<Icon variant="folder"/>
					<Icon variant="mesh_globe" class="absolute inset-0 m-auto text-c0 w-6 h-6"/>
				</div>
				<SimpleWindow slot="content" content_web="/compiler?noheader"/>
			</DesktopShortcut>
		</div>
		<div id="toolbar-bottom" class="toolbar">
			<div id="tabs" class="toolbar-item"></div>
			<div id="timer" class="toolbar-item"></div>
		</div><!-- toolbar -->
	</div>
	<script src="src/js/window.js"></script>
</Layout>

<style>
.wallpaper{
	position:relative;
	height: 100%;
	width: 100%;
	overflow: hidden;
}
.bg {
	position:absolute;
	top: 0;
	bottom: 0;
	left: 0;
	width: 100%;
	background: rgb(16,8,14);
	background: linear-gradient(0deg, rgba(16,8,14,1) 0%, rgba(46,14,51) 62%, rgb(148, 33, 62) 100%);
}
.mountains {
	position:absolute;
	inset: 0;
	width: 200%;
	background: url("/portal/img/bg/Mountains.svg") repeat-x bottom;
	background-size: 100vw;
	animation: roll linear 20s infinite;
}
.stars {
	position:absolute;
	top: 0;
	bottom: 450px;
	left: 0;
	width: 200%;
	background: url("/portal/img/bg/Stars.svg") repeat-x bottom;
	background-size: 100vw;
	animation: roll linear 70s infinite;
}
.trees {
	position:absolute;
	inset: 0;
	width: 200%;
	background: url("/portal/img/bg/Trees.svg") repeat-x bottom;
	background-size: 100vw;
	animation: roll linear 30s infinite;
}
.sun {
	position: absolute;
	background: radial-gradient(circle at 65% 80%, rgba(214, 74, 31, 0.774) 0%, rgba(248, 30, 175, 0.5) 30%, rgba(0,0,0,0) 50%);
	inset: 0;
	animation: float ease-in-out 25s infinite alternate-reverse;
}
.sun-center {
	position:absolute;
	right: 25%;
	bottom: 10%;
	width: 20vw;
	height: 20vw;
	background: url("/portal/img/bg/Sun.svg") repeat-x bottom;
	background-size: 20vw;
}
@keyframes roll {
	from {
		transform: translateX(0);
	}
	to {
		transform: translateX(-50%);
	}
}

@keyframes float {
	from {
		transform: translateY(0);
	}
	to {
		transform: translateY(75%);
	}
}
</style>